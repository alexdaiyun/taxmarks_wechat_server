  
税签-微信公众平台消息应用服务
=========================

## 微信接口服务(wxplatform)

    响应微信服务器相关事件及消息的处理

    http://域名地址/api/weixin


### 路由

#### 微信服务器消息接入

`/weixin`

##### 功能描述：  

* 微信服务器推送消息验证  
* 接受微信消息处理 - 普通消息  
* 接受微信消息处理 - 事件推送  
* 接受微信消息处理 - 多客服转发


##### 普通消息响应处理

* 文本消息 
1）文本中包含'?'字符  
事件处理：利用微信提供的发送消息-被动文本消息功能，向微信用户推送自定义的文本消息

##### 事件推送响应处理

* 关注事件  
**事件处理：** 向微信用户推送自定义的文本消息

* 自定义菜单事件 - 点击菜单拉取消息时的事件推送：  

  1）账号绑定  
	**事件类型：** click  
	**事件KEY值：** bind_weixin  
	**事件处理：**  向微信用户推送带链接地址的文本消息，此链接地址指向微信开发服务器的微信验证引导页面  
	`http://taxmarksmp.duapp.com/wx_auth_redirect?menucode=101` 

* 自定义菜单事件 - 点击菜单跳转链接时的事件推送：  
	**事件类型：** view  
	**事件处理：** 由微信服务器默认处理  





  


## 微信接口RestApi及后台管理(backend)

### 路由

##### 默认路由

`/`

##### 后台登录
`/login`

##### 用户列表
`/user`



### 微信授权处理页面说明



##### 预处理对用户执行微信oauth授权的引导  

`/wx_auth_redirect`

描述：  
    用户被引导至 `/wx_auth`

参数:  
    menucode  功能代码 具体请见`/wx_auth`中的相应参数说明


##### 微信用户在微信中进行微信oauth授权处理页面  

`/wx_auth`  
描述：  
    微信授权成功后获得code，利用code换取access_token，同时获得openid
    根据menucode代码，执行相应的页面跳转
    没有menucode参数时， 默认进入SSO验证页面  SsoRedirect.aspx

参数:  
    menucode 功能代码   
    100  税签微信版的SSO验证页面  
    101  税签微信版的绑定微信页面  
    102  税签微信版的注册用户页面（同时绑定微信） 
    200  进入绑定页面 (待定功能）
    201  进入问答(weCenter)页面  
    202  进入问答(weCenter)发布页面     

注：  
1）当menucode为1xx时，url值必须是税签微信版中的路径地址


##### 微信绑定验证 (暂不使用）
`/wx/authorization`  
  openid   用户的openid  
  url      需要跳转的页面  
  





## 微信接口Api SDK for python (weixinApi)
  
此处内容为空

***

  
## 支持BAE平台布署

此处内容为空

***


## 待解决问题
* 记录用户在注册绑定页面时的操作日志


 
